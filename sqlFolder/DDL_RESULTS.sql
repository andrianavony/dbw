START TRANSACTION;
SET foreign_key_checks = 0;

DROP TABLE IF EXISTS `RESULTS`;
CREATE TABLE IF NOT EXISTS `RESULTS` (
`HERITED` tinyint(1) NULL,
`IDARTICLE`     varchar(50)             NULL,
`BATCHNAME`       varchar(50) NULL,
`LIMSSAMPLEID`       varchar(50) NULL,
`LIMSIDANALYSIS` bigint(20) NULL,
`ANALYSISNAME` varchar(50) NULL,
`METHODNAME` varchar(50) NULL,
`REPETITION` smallint(6) NULL,
  `SUBREPETITION` smallint(6) NULL,
`MEASURENAME` varchar(50) NULL,
  `RAWRESULTS` varchar(50) NULL,
  `FORMATED` varchar(50) NULL,
`LIMSIDSERIES` bigint(20) NULL ,
`IDSERIES`       bigint(20) NULL ,

    `CREATIONDATE`  datetime NULL,
    `STATUSLABEL`       varchar(50) NULL,

    `APPROBATIONSTATUSLABEL`       varchar(50) NULL,
    `ANALYSISAPPROBATIONSTATUSLABEL`       varchar(50) NULL,
    `APPORVED` smallint(6) NULL,
    `APPORVEDBY` varchar(50) NULL,
    `APPORVEDDATE` datetime NULL,

 `IDRESULT` bigint(20) NULL AUTO_INCREMENT,
`IDMEASURE` bigint(20) NULL ,
`LIMSMEASUREID` bigint(20) NULL ,

`LIMSCOUNTERANALYSISSAMPELID` varchar(50) NULL,
`COUNTERANALYSISIDLIMS` varchar(50) NULL,
`COUNTERANALYSIS` smallint(6) NULL,

`IDBATCH` bigint(20) NULL,
`IDCASEFILE`    bigint(20)              NULL,
`IDSAMPLES` bigint(20) NULL,

`LIMSID` bigint(20) NULL ,
`LIMSBATCHID` bigint(20) NULL,
`LIMSFOLDERNO`       varchar(50) NULL,

  `IDANALYSIS` bigint(20) NULL ,
  `IDMODELANALYSIS` bigint(20) NULL,

`LIMSIDMETHOD`  varchar(50) NULL,
  `IDMETHOD` bigint(20) NULL,
`IDMETHODDETAILS` bigint(20) NULL ,

`IDSPECIFICATION` bigint(20),

`IDSTATUS` tinyint(1) NULL,

`IDAPPROBATIONSTATUS` tinyint(1) NULL,
`ANALYSISIDAPPROBATIONSTATUS` tinyint(1) NULL,
`ANALYSISIDSTATUS` tinyint(1) NULL,
`ANALYSISSTATUSLABEL` tinyint(1) NULL,


  `DESCRIPTION`     varchar(50) NULL,
 
  `ISVIRTUAL` tinyint(1) NULL,
  `ISFINAL` tinyint(1) NULL,
  `ISRESULTS` tinyint(1) NULL,
  `ISREQUIRED` tinyint(1) NULL,
  `OCCURENCE` smallint(6) NULL,

  `OFFICIALENAME` varchar(50) NULL,
  `MAINGROUP` varchar(50) NULL,
  `SUBGROUP` varchar(50) NULL,
  `MEASUREMASTER` varchar(50) NULL,
  `MEASUREDETAILS` varchar(50) NULL,
  
  `VALUEMIN`  DOUBLE NULL ,
  `PREFERDVALUEMIN` DOUBLE NULL ,
  `PREFERDVALUEMAX` DOUBLE NULL ,
  `VALUEMAX` DOUBLE NULL ,


  `DATEOFENTRY` datetime NULL,
  `IDUSER` bigint(20) NULL,
  `USERNAME` varchar(50) NULL,
  


`CONSIDERED` tinyint(1) NULL COMMENT 'Les résultats seront utililisé pour les calcul des analyses virtuelle',
      `PRODGROUP`       varchar(50) NULL,
      `IDSPECIE`        varchar(50) NULL,
      `IDSTAGE`         varchar(50) NULL,
    `COPIEDFROM`        varchar(50) NULL,
    `COPIEDFROMIDANALYSIS`         bigint(20) NULL,
    `COPIEDFROMIDSAMPLE`         bigint(20) NULL,
    `COPIEDFROMLIMSBATHCNAME`         varchar(50) NULL,
    `COPIEDFROMIDBATCH`         bigint(20) NULL,
  `ISRESULTSINSERTED` tinyint(1) NULL,

PRIMARY KEY (`IDRESULT`), 
KEY `KEY_RESULT_IDBATCH` (`IDBATCH`),
KEY `KEY_RESULT_IDCASEFILE` (`IDCASEFILE`),
KEY `KEY_RESULT_BATCHNAME` (`BATCHNAME`),
KEY `KEY_RESULT_IDSAMPLES` (`IDSAMPLES`),

KEY `KEY_RESULT_IDSPECIFICATION` (`IDSPECIFICATION`),
KEY `KEY_RESULT_IDANALYSIS` (`IDANALYSIS` ),
KEY `KEY_RESULT_IDMODELANALYSIS` (`IDMODELANALYSIS`),
KEY `KEY_RESULT_IDMETHOD` (`IDMETHOD`),
KEY `KEY_RESULT_IDMETHODDETAILS` (`IDMETHODDETAILS`),
KEY `KEY_RESULTS_IDMEASURE`  (`IDMEASURE` ),
KEY `KEY_RESULT_IDUSER`  (`IDUSER` )
) ENGINE=InnoDB DEFAULT CHARSET=latin1;

COMMIT;

START TRANSACTION;
    ALTER TABLE `RESULTS`
        ADD CONSTRAINT `FK_RESULTS_IDARTICLE` 
            FOREIGN KEY             (`IDARTICLE`) 
            REFERENCES `article`    (`IDARTICLE`);
COMMIT;

START TRANSACTION;
    ALTER TABLE                         `RESULTS`
    ADD CONSTRAINT `FK_RESULTS_IDSPECIE` 
    FOREIGN KEY                                  (`IDSPECIE`) 
    REFERENCES                          `specie` (`IDSPECIE`)
ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;

START TRANSACTION;
    ALTER TABLE                         `RESULTS`
    ADD CONSTRAINT `FK_RESULTS_IDSTAGE` 
    FOREIGN KEY                                     (`IDSTAGE`) 
    REFERENCES                          `stage` (`IDSTAGE`)
ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;

START TRANSACTION;
ALTER TABLE `RESULTS` ADD CONSTRAINT `FK_RESULTS_IDSPECIFICATION` 
FOREIGN KEY (`IDSPECIFICATION`)
REFERENCES `specification`(`IDSPECIFICATION`) 
ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;


START TRANSACTION;
ALTER TABLE                                         `RESULTS` 
ADD CONSTRAINT `FK_RESULTS_COPIEDFROMIDSAMPLE` 
                                        FOREIGN KEY             (`COPIEDFROMIDSAMPLE`) 
 REFERENCES `samples`(`IDSAMPLES`) 
ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;

START TRANSACTION;
ALTER TABLE                                         `RESULTS` 
ADD CONSTRAINT `FK_RESULTS_COPIEDFROMIDANALYSIS` 
                                        FOREIGN KEY             (`COPIEDFROMIDANALYSIS`) 
REFERENCES                                          `RESULTS`     (`IDANALYSIS`) 
ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;


START TRANSACTION;
ALTER TABLE                                         `RESULTS` 
ADD CONSTRAINT `FK_RESULTS_COPIEDFROMIDBATCH`             FOREIGN KEY                 (`COPIEDFROMIDBATCH`) 
REFERENCES                                          `batch`         (`IDBATCH`) 
ON DELETE RESTRICT ON UPDATE RESTRICT;

START TRANSACTION;
ALTER TABLE `RESULTS` 
ADD CONSTRAINT `FK_RESULTS_IDCASEFILE` 
FOREIGN KEY (`IDCASEFILE`) 
    REFERENCES `CASEFILE`(`IDCASEFILE`) 
ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;

START TRANSACTION;
ALTER TABLE `RESULTS` 
ADD CONSTRAINT `FK_RESULTS_IDSAMPLES` 
FOREIGN KEY (`IDSAMPLES`) 
REFERENCES `samples`(`IDSAMPLES`) 
ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;

START TRANSACTION;
ALTER TABLE `RESULTS` 
    ADD CONSTRAINT `FK_RESULTS_IDMODELANALYSIS` 
    FOREIGN KEY                 (`IDMODELANALYSIS`) 
    REFERENCES `modelanalysis`  (`IDMODELANALYSIS`)
 ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;


START TRANSACTION;
ALTER TABLE `RESULTS` 
ADD CONSTRAINT                      `FK_RESULTS_IDANALYSIS` 
FOREIGN KEY                                 (`IDANALYSIS`) 
REFERENCES `analysis`                       (`IDANALYSIS`) 
ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;

START TRANSACTION;
ALTER TABLE                              `RESULTS`
ADD CONSTRAINT                          `FK_RESULTS_IDMETHOD` 
FOREIGN KEY                                     (`IDMETHOD`) 
REFERENCES                              `method` (`IDMETHOD`) 
ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;

START TRANSACTION;
ALTER TABLE `results` ADD CONSTRAINT `FK_FORIDRESULTS_IDMEASURE` 
FOREIGN KEY (`IDMEASURE`) REFERENCES `measures`(`IDMEASURE`) 
ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;

START TRANSACTION;
ALTER TABLE `RESULTS` ADD CONSTRAINT `FK_IDRESULTS_IDUSER` 
    FOREIGN KEY                             (`IDUSER`) 
    REFERENCES `user`                    (`IDUSER`) 
ON DELETE RESTRICT ON UPDATE RESTRICT;
COMMIT;

SET foreign_key_checks = 1;